# 3 基本

このセクションでは, `GTK+`で重要となる要素について紹介していきます.

## 3.1 メインループとシグナル

多くの GUIツールキットと同じように, `GTK+`はイベントドリブンプログラミング
モデルを採用しています. ユーザが何もしない時, `GTK+`はメインループで入力を
待ちます. ユーザがマウスクリックなどのアクションを起こせば, メインループを
起こし, イベントが伝達されます.

ウィジェットがイベントを受け取るとき, 1つないし複数のシグナルが発行されます.
シグナルは, あなたがシグナルに登録した関数を呼び出すことで, "何かが起きた"
ということを通知します. このような関数はコールバック関数と一般的に言われます.
コールバック関数が呼び出されるとき, 何かアクションを起こします, 例えば
開くボタンが押されたとき, ファイル選択ウィジェットを表示するなどがあります.

コールバック関数処理が終わったとき, `GTK+`はメインループに戻って,
ユーザの入力を再び待ちます.

一般的にコールバック関数の登録は以下のようになります.

```python
handler_id = widget.connect("event", callback, data)
```

`widget`はこれより前に作られたウィジェットインスタンスです.
初めの引数はイベント名です. ウィジェットごとに起こりうるイベントが存在します.
例えば, ボタンウィジェットであれば, "clicked"イベントという具合です.
これはボタンがクリックされたとき, シグナルが送られることを意味します.
次の引数 `callback`はコールバック関数の名前です. これは指定したイベントが
発生したときに実行されます. 最後の引数 `data`はシグナルが発生したときに,
渡すべき任意のデータを指定します. しかしこの引数はオプションで必要なければ
省略することも可能です.

`connect`メソッドは, シグナルとコールバックを識別するための数値を返します.
その数値はシグナルからコールバックの接続を解除するときに必要になります.
これから先コールバック関数を呼ばれたときないときなどに使います.

```python
widget.disconnect(handler_id)
```

もし `handler_id`を何かの理由で失ってしまったとき(例えばハンドラを
`Gtk.Builder.connect_signales()`を使って設定したとき),
`disconnect_by_func()`という関数を使うことで, 特定のコールバック
関数を解除することができます.

```python
widget.disconnect_by_func(callback)
```

ほとんどすべてのアプリケーションでは, `delete-event`シグナルを
トップレベルのウインドウに設定することになるでしょう. そのシグナルは
ユーザがトップレベルのウインドウを閉じようとしたときに発行されます.
このシグナルのデフォルトハンドは Windowオブジェクトの破棄は行いますが,
アプリケーションを終了することは行いません. `delete-event`シグナルに
`Gtk.main_quit()`関数を登録することで, 望まれる振る舞いとなります.

```python
window.connect("delete-event", Gtk.main_quit)
```

`Gtk.main_quit()`を呼び出すことで, `Gtk.main()`のメインループから
抜け出すことができます.


## 3.2 プロパティ

プロパティは, ウィジェットの設定と状態を示します. シグナルに関して,
各ウィジェットは一連の特別なプロパティを持ちます. 例えばボタンは,
内包する labelウイジェットのテキストである **label**プロパティを
持ちます. ウイジェットインスタンスを作成するときの, キーワード引数を
使って任意の数のプロパティの名前と値を指定することができます.
"Hello World"というラベルを右寄せで 25度傾むかせるには, 次のように
します.

```python
label = Gtk.Label(label="Hello World", angle=25, haligh=Gtk.Aligh.END)
```

これは以下と等価です.

```python
label = Gtk.Label()
label.set_label("Hello World")
label.set_angle(25)
label.set_haligh(Gtk.Align.END)
```

ゲッタ, セッタを使う代わりに, `widget.get_property("prop-name")`
及び `widget.set_property("prop-name", value)`を使うこともできます.
